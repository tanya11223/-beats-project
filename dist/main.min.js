(()=>{const a=e=>{const t=e.find(".color__item"),o=e.find(".color__content");t.removeClass("active"),o.width(0)},i=e=>{const t=e.find(".color__content");var o=(e=>{let t=0;var o=$(window).width();const n=e.closest(".colors__list"),a=n.find(".color__title");var i=a.width()*a.length;const r=e.find(".color__container");var e=parseInt(r.css("padding-left")),l=parseInt(r.css("padding-right")),s=window.matchMedia("(max-width: 768px)").matches,d=window.matchMedia("(max-width: 480px)").matches;return s&&(t=o-i),d&&(t=o-a.width()),{container:t=s||d?t:500,textContainer:t-l-e}})(e);e.addClass("active"),t.width(o.container)};$(".color__title").on("click",e=>{e.preventDefault();const t=$(e.currentTarget),o=t.closest(".color__item");var e=o.hasClass("active"),n=t.closest(".colors__list");e?a(n):(a(n),i(o))})})();const validateFields=(e,t)=>{return t.forEach(e=>{e.removeClass(".input-error"),""==e.val().trim()&&e.addClass("input-error")}),0==e.find(".input-error").length};$(".form").submit(e=>{e.preventDefault();const t=$(e.currentTarget),o=t.find("[name='name']"),n=t.find("[name='phone']"),a=t.find("[name='comment']"),i=t.find("[name= 'to']"),r=$("#modal"),l=r.find(".modal__content");if(r.removeClass("error-modal"),validateFields(t,[o,n,a,i])){const s=$.ajax({url:"https://webdev-api.loftschool.com/sendmail",method:"post",data:{name:o.val(),phone:n.val(),comment:a.val(),to:i.val()}});s.done(e=>{l.text(e.message)}),s.fail(e=>{e=e.responseJSON.message;l.text(e),r.addClass("error-modal")}),s.always(()=>{$.fancybox.open({src:"#modal",type:"inline"})})}}),$(".app-close-btn").click(e=>{e.preventDefault(),$.fancybox.close()});let myMap;const init=()=>{myMap=new ymaps.Map("map",{center:[55.76,37.64],zoom:11,controls:[]});const t=new ymaps.GeoObjectCollection({},{draggable:!1,iconLayout:"default#image",iconImageHref:"./img/marker.svg",iconImageSize:[46,57],iconImageOffset:[-35,-52]});[[55.757349,37.622441],[55.759132,37.580903],[55.740644,37.580732],[55.742605,37.599911]].forEach(e=>{t.add(new ymaps.Placemark(e))}),myMap.geoObjects.add(t),myMap.behaviors.disable("scrollZoom")},openMenu=(ymaps.ready(init),document.querySelector("#openOverlay")),body=document.body,create=createModal();function createModal(){const t=document.createElement("div");t.classList.add("overlay");var e=document.querySelector("#overlayTemplate");t.innerHTML=e.innerHTML;const o=t.querySelector("#close");return o.addEventListener("click",e=>{e.preventDefault(),body.removeChild(t)}),t.addEventListener("click",e=>{e.preventDefault(),e.target.classList.contains("menu__link")&&body.removeChild(t)}),t}openMenu.addEventListener("click",e=>{e.preventDefault(),body.appendChild(create)});const sections=$("section"),display=$(".maincontent"),sidemenu=$(".fixed-menu"),menuItems=sidemenu.find(".fixed-menu__item"),mobileDetect=new MobileDetect(window.navigator.userAgent),isMobile=mobileDetect.mobile();let inscroll=!1;sections.first().addClass("active");const countSectionPosition=e=>{e*=-100;return isNaN(e)?(console.error("передано неверное значение в countSectionPosition"),0):e},resetActiveClassForItem=(e,t,o)=>{e.eq(t).addClass(o).siblings().removeClass(o)},performTransition=e=>{var t;inscroll||(inscroll=!0,t=countSectionPosition(e),display.css({transform:`translateY(${t}%)`}),resetActiveClassForItem(sections,e,"active"),setTimeout(()=>{inscroll=!1,resetActiveClassForItem(menuItems,e,"fixed-menu__item--active")},1300))},viewportScroller=()=>{const e=sections.filter(".active"),t=e.next(),o=e.prev();return{next(){t.length&&performTransition(t.index())},prev(){o.length&&performTransition(o.index())}}},playBtn=($(window).on("wheel",e=>{e=e.originalEvent.deltaY;const t=viewportScroller();0<e&&t.next(),e<0&&t.prev()}),$(window).on("keydown",e=>{var t=e.target.tagName.toLowerCase(),t="input"==t||"textarea"==t;const o=viewportScroller();if(!t)switch(e.keyCode){case 38:o.prev();break;case 40:o.next()}}),$(".wrapper").on("touchmove",e=>e.preventDefault()),$(document).on("click","[data-scroll-to]",e=>{e.preventDefault();const t=$(e.currentTarget);e=t.attr("data-scroll-to");const o=$(`[data-section-id=${e}]`);performTransition(o.index())}),isMobile&&$("body").swipe({swipe:function(e,t){const o=viewportScroller();let n="down"==t?"prev":"up"==t?"next":"";n&&o[n]()}}),document.querySelector(".video__player-img")),video=document.getElementById("player"),playerPlayBrn=document.querySelector(".duration__img"),durationControl=document.getElementById("durationLevel"),soundControl=document.getElementById("micLevel"),soundBtn=document.getElementById("soundBtn"),dynamicBtn=document.getElementById("dynamic");let intervalId,soundLevel;function playStop(e){e.stopPropagation(),playerPlayBrn.classList.toggle("video__player-img--active"),playBtn.classList.toggle("active"),video.paused?(video.play(),intervalId=setInterval(updateDuration,1e3/60)):(clearInterval(intervalId),video.pause())}function setVideoDuration(){video.currentTime=durationControl.value,updateDuration()}function updateDuration(){durationControl.value=video.currentTime;var e=video.duration/100,e=video.currentTime/e;durationControl.style.background=`linear-gradient(90deg, #E01F3D 0%, #E01F3D ${e}%, #333 ${e}%)`}function changeSoundVolume(){video.volume=soundControl.value/10,0==video.volume?soundBtn.classList.add("active"):soundBtn.classList.remove("active")}function soundOf(){0===video.volume?(video.volume=soundLevel,soundControl.value=10*soundLevel,soundBtn.classList.remove("active")):(soundLevel=video.volume,video.volume=0,soundControl.value=0,soundBtn.classList.add("active"))}video.addEventListener("loadeddata",function(){video.addEventListener("click",playStop);let t=document.querySelectorAll(".play");for(let e=0;e<t.length;e++)t[e].addEventListener("click",playStop);durationControl.min=0,durationControl.value=0,durationControl.max=video.duration,durationControl.addEventListener("input",setVideoDuration),soundControl.min=0,soundControl.max=10,soundControl.value=soundControl.max,soundControl.addEventListener("input",changeSoundVolume),dynamicBtn.addEventListener("click",soundOf),video.addEventListener("ended",()=>{playBtn.classList.toggle("video__player-img--active"),playerPlayBrn.classList.remove("active"),video.currentTime=0})});const slider=$(".products__list").bxSlider({pager:!1,controls:!1}),findBlockByAlias=($(".product-slider__arrow--prev").click(e=>{e.preventDefault(),slider.goToPrevSlide()}),$(".product-slider__arrow--next").click(e=>{e.preventDefault(),slider.goToNextSlide()}),o=>$(".reviews__item").filter((e,t)=>$(t).attr("data-linked-with")==o)),openItem=($(".review-switcher__link").click(e=>{e.preventDefault();const t=$(e.currentTarget);e=t.attr("data-open");const o=findBlockByAlias(e),n=t.closest(".interactive-avatar");o.addClass("active").siblings().removeClass("active"),n.addClass("active").siblings().removeClass("active")}),e=>{const t=e.closest(".team__item"),o=t.find(".team__content"),n=o.find(".team__content-block");e=n.height();t.addClass("active"),o.height(e)}),closeEveryItem=e=>{const t=e.find(".team__content"),o=e.find(".team__item");o.removeClass("active"),t.height(0)};$(".team__title").click(e=>{const t=$(e.currentTarget);e=t.closest(".team");const o=t.closest(".team__item");o.hasClass("active")?closeEveryItem(e):(closeEveryItem(e),openItem(t))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbG9ycy1tZW51LWFjY28uanMiLCJmb3JtLW1vZGFsLmpzIiwibWFwLmpzIiwibWVudS5qcyIsIm9wcy5qcyIsInBsYXllci5qcyIsInNsaWRlci5qcyIsInRhYnMuanMiLCJ0ZWFtLmpzIl0sIm5hbWVzIjpbImNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIiLCJjb250YWluZXIiLCJpdGVtcyIsImZpbmQiLCJjb250ZW50IiwicmVtb3ZlQ2xhc3MiLCJ3aWR0aCIsIm9wZW5JdGVtIiwiaXRlbSIsImhpZGRlbkNvbnRlbnQiLCJyZXFXaWR0aCIsImxldCIsInJlcUl0ZW1XaWR0aCIsInNjcmVlbldpZHRoIiwiJCIsIndpbmRvdyIsImNsb3Nlc3QiLCJ0aXRsZXNCbG9ja3MiLCJ0aXRsZXNXaWR0aCIsImxlbmd0aCIsInRleHRDb250YWluZXIiLCJwYWRkaW5nTGVmdCIsInBhcnNlSW50IiwiY3NzIiwicGFkZGluZ1JpZ2h0IiwiaXNUYWJsZXQiLCJtYXRjaE1lZGlhIiwibWF0Y2hlcyIsImlzTW9iaWxlIiwibWVzdXJlV2lkdGgiLCJhZGRDbGFzcyIsIm9uIiwiZSIsInByZXZlbnREZWZhdWx0IiwiJHRoaXMiLCJjdXJyZW50VGFyZ2V0IiwiaXRlbU9wZW5lZCIsImhhc0NsYXNzIiwidmFsaWRhdGVGaWVsZHMiLCJmb3JtIiwiZmllbGRzQXJyYXkiLCJmb3JFYWNoIiwiZmllbGQiLCJ2YWwiLCJ0cmltIiwic3VibWl0IiwibmFtZSIsInBob25lIiwiY29tbWVudCIsInRvIiwibW9kYWwiLCJyZXF1ZXN0IiwiYWpheCIsInVybCIsIm1ldGhvZCIsImRhdGEiLCJkb25lIiwidGV4dCIsIm1lc3NhZ2UiLCJmYWlsIiwicmVzcG9uc2VKU09OIiwiYWx3YXlzIiwiZmFuY3lib3giLCJvcGVuIiwic3JjIiwidHlwZSIsImNsaWNrIiwiY2xvc2UiLCJteU1hcCIsImluaXQiLCJ5bWFwcyIsIk1hcCIsImNlbnRlciIsInpvb20iLCJjb250cm9scyIsIm15Q29sbGVjdGlvbiIsIkdlb09iamVjdENvbGxlY3Rpb24iLCJkcmFnZ2FibGUiLCJpY29uTGF5b3V0IiwiaWNvbkltYWdlSHJlZiIsImljb25JbWFnZVNpemUiLCJpY29uSW1hZ2VPZmZzZXQiLCJjb29yZCIsImFkZCIsIlBsYWNlbWFyayIsImdlb09iamVjdHMiLCJiZWhhdmlvcnMiLCJkaXNhYmxlIiwib3Blbk1lbnUiLCJyZWFkeSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvZHkiLCJjcmVhdGUiLCJjcmVhdGVNb2RhbCIsIm92ZXJsYXlFbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsInRlbXBsYXRlIiwiaW5uZXJIVE1MIiwiY2xvc2VFbGVtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUNoaWxkIiwidGFyZ2V0IiwiY29udGFpbnMiLCJhcHBlbmRDaGlsZCIsInNlY3Rpb25zIiwiZGlzcGxheSIsInNpZGVtZW51IiwibWVudUl0ZW1zIiwibW9iaWxlRGV0ZWN0IiwiTW9iaWxlRGV0ZWN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwibW9iaWxlIiwiaW5zY3JvbGwiLCJmaXJzdCIsImNvdW50U2VjdGlvblBvc2l0aW9uIiwicG9zaXRpb24iLCJpc05hTiIsImNvbnNvbGUiLCJlcnJvciIsInJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtIiwiaXRlbUVxIiwiYWN0aXZlQ2xhc3MiLCJlcSIsInNpYmxpbmdzIiwicGVyZm9ybVRyYW5zaXRpb24iLCJzZWN0aW9uRXEiLCJ0cmFuc2Zvcm0iLCJzZXRUaW1lb3V0IiwidHJhbnNpdGlvbk92ZXIiLCJ2aWV3cG9ydFNjcm9sbGVyIiwiYWN0aXZlU2VjdGlvbiIsImZpbHRlciIsIm5leHRTZWN0aW9uIiwibmV4dCIsInByZXZTZWN0aW9uIiwicHJldiIsImluZGV4IiwicGxheUJ0biIsImRlbHRhWSIsIm9yaWdpbmFsRXZlbnQiLCJzY3JvbGxlciIsInRhZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsInVzZXJUeXBpbmdJbklucHV0cyIsImtleUNvZGUiLCJhdHRyIiwicmVxU2VjdGlvbiIsInN3aXBlIiwiZXZlbnQiLCJkaXJlY3Rpb24iLCJzY3JvbGxEaXJlY3Rpb24iLCJ2aWRlbyIsImdldEVsZW1lbnRCeUlkIiwicGxheWVyUGxheUJybiIsImR1cmF0aW9uQ29udHJvbCIsInNvdW5kQ29udHJvbCIsInNvdW5kQnRuIiwiZHluYW1pY0J0biIsImludGVydmFsSWQiLCJzb3VuZExldmVsIiwicGxheVN0b3AiLCJzdG9wUHJvcGFnYXRpb24iLCJ0b2dnbGUiLCJwYXVzZWQiLCJwbGF5Iiwic2V0SW50ZXJ2YWwiLCJ1cGRhdGVEdXJhdGlvbiIsImNsZWFySW50ZXJ2YWwiLCJwYXVzZSIsInNldFZpZGVvRHVyYXRpb24iLCJjdXJyZW50VGltZSIsInZhbHVlIiwic3RlcCIsImR1cmF0aW9uIiwicGVyY2VudCIsInN0eWxlIiwiYmFja2dyb3VuZCIsImNoYW5nZVNvdW5kVm9sdW1lIiwidm9sdW1lIiwicmVtb3ZlIiwic291bmRPZiIsInBsYXlCdXR0b25zIiwicXVlcnlTZWxlY3RvckFsbCIsIm1pbiIsIm1heCIsInNsaWRlciIsImJ4U2xpZGVyIiwicGFnZXIiLCJmaW5kQmxvY2tCeUFsaWFzIiwiZ29Ub1ByZXZTbGlkZSIsImdvVG9OZXh0U2xpZGUiLCJhbGlhcyIsIm5keCIsIml0ZW10b1Nob3ciLCJjdXJJdGVtIiwiY29udGVudEJsb2NrIiwidGV4dEJsb2NrIiwicmVxSGVpZ2h0IiwiaGVpZ2h0IiwiY2xvc2VFdmVyeUl0ZW0iLCJpdGVtQ29udGFpbmVyIiwiZWxlbUNvbnRhaW5lciJdLCJtYXBwaW5ncyI6IkNBQUEsS0FFQSxNQStCQUEsRUFBQUMsSUFDQSxNQUFBQyxFQUFBRCxFQUFBRSxLQUFBLGdCQUNBQyxFQUFBSCxFQUFBRSxLQUFBLG1CQUVBRCxFQUFBRyxZQUFBLFVBQ0FELEVBQUFFLE1BQUEsSUFHQUMsRUFBQUMsSUFDQSxNQUFBQyxFQUFBRCxFQUFBTCxLQUFBLG1CQUNBLElBQUFPLEdBekNBRixJQUNBRyxJQUFBQyxF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QUEsVUFBQWdHLFdBQUF6SCxZQUFBLFVBQ0FnTSxFQUFBdkssU0FBQSxVQUFBZ0csV0FBQXpILFlBQUEsWUNmQUcsSUFDQSxNQUFBUCxFQUFBTyxFQUFBUSxRQUFBLGVBQ0FzTCxFQUFBck0sRUFBQUUsS0FBQSxrQkFDQW9NLEVBQUFELEVBQUFuTSxLQUFBLHdCQUNBcU0sRUFBQUQsRUFBQUUsU0FHQXhNLEVBQUE2QixTQUFBLFVBQ0F3SyxFQUFBRyxPQUFBRCxLQUdBRSxlQUFBek0sSUFDQSxNQUFBQyxFQUFBRCxFQUFBRSxLQUFBLGtCQUNBd00sRUFBQTFNLEVBQUFFLEtBQUEsZUFFQXdNLEVBQUF0TSxZQUFBLFVBQ0FILEVBQUF1TSxPQUFBLElBR0EzTCxFQUFBLGdCQUFBb0QsTUFBQWxDLElBQ0EsTUFBQUUsRUFBQXBCLEVBQUFrQixFQUFBRyxlQUNBbEMsRUFBQWlDLEVBQUFsQixRQUFBLFNBQ0EsTUFBQTRMLEVBQUExSyxFQUFBbEIsUUFBQSxlQUVBNEwsRUFBQXZLLFNBQUEsVUFDQXFLLGVBQUF6TSxJQUVBeU0sZUFBQXpNLEdBQ0FNLFNBQUEyQiIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIigoKT0+e1xuXG5jb25zdCBtZXN1cmVXaWR0aCA9IGl0ZW0gPT4ge1xuICBsZXQgcmVxSXRlbVdpZHRoID0gMDtcbiAgY29uc3Qgc2NyZWVuV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcbiAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLmNvbG9yc19fbGlzdFwiKTtcbiAgY29uc3QgdGl0bGVzQmxvY2tzID0gY29udGFpbmVyLmZpbmQoXCIuY29sb3JfX3RpdGxlXCIpO1xuICBjb25zdCB0aXRsZXNXaWR0aCA9IHRpdGxlc0Jsb2Nrcy53aWR0aCgpICogdGl0bGVzQmxvY2tzLmxlbmd0aDtcblxuICBjb25zdCB0ZXh0Q29udGFpbmVyID0gaXRlbS5maW5kKFwiLmNvbG9yX19jb250YWluZXJcIik7XG4gIGNvbnN0IHBhZGRpbmdMZWZ0ID0gcGFyc2VJbnQodGV4dENvbnRhaW5lci5jc3MoXCJwYWRkaW5nLWxlZnRcIikpO1xuICBjb25zdCBwYWRkaW5nUmlnaHQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctcmlnaHRcIikpO1xuXG5cbiAgY29uc3QgaXNUYWJsZXQgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDc2OHB4KVwiKS5tYXRjaGVzO1xuICBjb25zdCBpc01vYmlsZSA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogNDgwcHgpXCIpLm1hdGNoZXM7XG5cbiAgaWYoaXNUYWJsZXQpIHtcbiAgICByZXFJdGVtV2lkdGggPSBzY3JlZW5XaWR0aCAtIHRpdGxlc1dpZHRoO1xuICB9IFxuICBpZihpc01vYmlsZSkge1xuICAgIHJlcUl0ZW1XaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVzQmxvY2tzLndpZHRoKCk7XG4gIH0gXG4gIGlmKCFpc1RhYmxldCAmJiAhaXNNb2JpbGUpe1xuICAgIHJlcUl0ZW1XaWR0aCA9IDUwMDtcbiAgfVxuXG4gIHJldHVybntcbiAgICBjb250YWluZXI6IHJlcUl0ZW1XaWR0aCxcbiAgICB0ZXh0Q29udGFpbmVyOiByZXFJdGVtV2lkdGggLSBwYWRkaW5nUmlnaHQgLSBwYWRkaW5nTGVmdFxuICB9XG59O1xuXG5jb25zdCBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyID0gY29udGFpbmVyID0+IHtcbiAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi5jb2xvcl9faXRlbVwiKTtcbiAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5maW5kKFwiLmNvbG9yX19jb250ZW50XCIpO1xuXG4gIGl0ZW1zLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICBjb250ZW50LndpZHRoKDApO1xufTtcblxuY29uc3Qgb3Blbkl0ZW0gPSBpdGVtID0+IHtcbiAgY29uc3QgaGlkZGVuQ29udGVudCA9IGl0ZW0uZmluZChcIi5jb2xvcl9fY29udGVudFwiKTtcbiAgY29uc3QgcmVxV2lkdGggPSBtZXN1cmVXaWR0aChpdGVtKTtcblxuICBpdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICBoaWRkZW5Db250ZW50LndpZHRoKHJlcVdpZHRoLmNvbnRhaW5lcik7XG59XG5cbiQoXCIuY29sb3JfX3RpdGxlXCIpLm9uKFwiY2xpY2tcIiwgKGUpID0+e1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIFxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgaXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIuY29sb3JfX2l0ZW1cIik7XG4gIGNvbnN0IGl0ZW1PcGVuZWQgPSBpdGVtLmhhc0NsYXNzKFwiYWN0aXZlXCIpO1xuICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLmNvbG9yc19fbGlzdFwiKTtcblxuICBpZiAoaXRlbU9wZW5lZCkge1xuICAgIGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIoY29udGFpbmVyKVxuICB9IGVsc2Uge1xuICAgIGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIoY29udGFpbmVyKVxuICAgIG9wZW5JdGVtKGl0ZW0pO1xuICB9XG59KTtcbn0pKCk7IiwiY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcbiAgZmllbGRzQXJyYXkuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgZmllbGQucmVtb3ZlQ2xhc3MoXCIuaW5wdXQtZXJyb3JcIik7XG4gICAgaWYgKGZpZWxkLnZhbCgpLnRyaW0oKSA9PSBcIlwiKSB7XG4gICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgZXJyb3JGaWVsZHMgPSBmb3JtLmZpbmQoXCIuaW5wdXQtZXJyb3JcIik7XG5cbiAgcmV0dXJuIGVycm9yRmllbGRzLmxlbmd0aCA9PSAwO1xufVxuXG4kKFwiLmZvcm1cIikuc3VibWl0KGUgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgbmFtZSA9IGZvcm0uZmluZChcIltuYW1lPSduYW1lJ11cIik7XG4gIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7XG4gIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpO1xuICBjb25zdCB0byA9IGZvcm0uZmluZChcIltuYW1lPSAndG8nXVwiKTtcblxuICBjb25zdCBtb2RhbCA9ICQoXCIjbW9kYWxcIik7XG4gIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKFwiLm1vZGFsX19jb250ZW50XCIpO1xuICBcbiAgbW9kYWwucmVtb3ZlQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcblxuICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGaWVsZHMoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xuICBcbiAgXG4gIFxuXG4gIGlmIChpc1ZhbGlkKSB7XG4gICAgY29uc3QgcmVxdWVzdCA9ICQuYWpheCh7XG4gICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXG4gICAgICBtZXRob2Q6IFwicG9zdFwiLFxuICAgICAgZGF0YToge1xuICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxuICAgICAgICBwaG9uZTogcGhvbmUudmFsKCksXG4gICAgICAgIGNvbW1lbnQ6IGNvbW1lbnQudmFsKCksXG4gICAgICAgIHRvOiB0by52YWwoKSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXF1ZXN0LmRvbmUoZGF0YSA9PntcbiAgICAgIGNvbnRlbnQudGV4dChkYXRhLm1lc3NhZ2UpO1xuICAgIH0pO1xuXG4gICAgcmVxdWVzdC5mYWlsKGRhdGEgPT57XG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcbiAgICAgIGNvbnRlbnQudGV4dChtZXNzYWdlKTtcbiAgICAgIG1vZGFsLmFkZENsYXNzKFwiZXJyb3ItbW9kYWxcIik7XG4gICAgfSk7XG5cbiAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XG4gICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xuICAgICAgICBzcmM6IFwiI21vZGFsXCIsXG4gICAgICAgIHR5cGU6IFwiaW5saW5lXCJcbiAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxufSk7XG5cbiQoXCIuYXBwLWNsb3NlLWJ0blwiKS5jbGljayhlID0+e1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgJC5mYW5jeWJveC5jbG9zZSgpO1xufSk7IiwibGV0IG15TWFwO1xuXG5jb25zdCBpbml0ID0gKCkgPT4ge1xuICBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xuICAgIGNlbnRlcjogWzU1Ljc2LCAzNy42NF0sXG4gICAgem9vbTogMTEsXG4gICAgY29udHJvbHM6IFtdLFxuICB9KTtcblxuICBjb25zdCBjb29yZHMgPSBbXG4gICAgWzU1Ljc1NzM0OSwgMzcuNjIyNDQxXSxcbiAgICBbNTUuNzU5MTMyLCAzNy41ODA5MDNdLFxuICAgIFs1NS43NDA2NDQsIDM3LjU4MDczMl0sXG4gICAgWzU1Ljc0MjYwNSwgMzcuNTk5OTExXSxcbiAgXTtcblxuICBjb25zdCBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbih7fSx7XG4gICAgIGRyYWdnYWJsZTogZmFsc2UsXG4gICAgIGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlJyxcbiAgICAgaWNvbkltYWdlSHJlZjogXCIuL2ltZy9tYXJrZXIuc3ZnXCIsXG4gICAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxuICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMzUsIC01Ml1cbiAgfSk7XG5cbiAgY29vcmRzLmZvckVhY2goY29vcmQgPT4ge1xuICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZCkpO1xuICB9KTtcblxuICBteU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xuXG4gIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKCdzY3JvbGxab29tJyk7XG59XG5cbnltYXBzLnJlYWR5KGluaXQpOyIsImNvbnN0IG9wZW5NZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNvcGVuT3ZlcmxheVwiKTtcbmNvbnN0IGJvZHkgPSBkb2N1bWVudC5ib2R5O1xuY29uc3QgY3JlYXRlID0gY3JlYXRlTW9kYWwoKTtcblxub3Blbk1lbnUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGJvZHkuYXBwZW5kQ2hpbGQoY3JlYXRlKTtcbn0pXG5cbmZ1bmN0aW9uIGNyZWF0ZU1vZGFsICgpIHtcbiAgY29uc3Qgb3ZlcmxheUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBvdmVybGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwib3ZlcmxheVwiKTsgXG5cbiAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI292ZXJsYXlUZW1wbGF0ZVwiKTtcblxuICBvdmVybGF5RWxlbWVudC5pbm5lckhUTUwgPSB0ZW1wbGF0ZS5pbm5lckhUTUw7IFxuXG4gIGNvbnN0IGNsb3NlRWxlbWVudCA9IG92ZXJsYXlFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2xvc2VcIik7XG5cbiAgY2xvc2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgYm9keS5yZW1vdmVDaGlsZChvdmVybGF5RWxlbWVudCk7XG4gIH0pO1xuXG4gIG92ZXJsYXlFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBpZihlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21lbnVfX2xpbmsnKSkge1xuICAgICAgYm9keS5yZW1vdmVDaGlsZChvdmVybGF5RWxlbWVudCk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gb3ZlcmxheUVsZW1lbnQ7XG59IiwiY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xuY29uc3Qgc2lkZW1lbnUgPSAkKFwiLmZpeGVkLW1lbnVcIik7XG5jb25zdCBtZW51SXRlbXMgPSBzaWRlbWVudS5maW5kKFwiLmZpeGVkLW1lbnVfX2l0ZW1cIik7XG5cbmNvbnN0IG1vYmlsZURldGVjdCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xuY29uc3QgaXNNb2JpbGUgPSBtb2JpbGVEZXRlY3QubW9iaWxlKCk7XG5cbmxldCBpbnNjcm9sbCA9IGZhbHNlO1xuXG5zZWN0aW9ucy5maXJzdCgpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuXG5jb25zdCBjb3VudFNlY3Rpb25Qb3NpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcbiAgY29uc3QgcG9zaXRpb24gPSBzZWN0aW9uRXEgKiAtMTAwO1xuXG4gIGlmIChpc05hTihwb3NpdGlvbikpIHtcbiAgICBjb25zb2xlLmVycm9yKFwi0L/QtdGA0LXQtNCw0L3QviDQvdC10LLQtdGA0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LIgY291bnRTZWN0aW9uUG9zaXRpb25cIik7XG4gICAgcmV0dXJuIDA7XG4gIH1cbiAgcmV0dXJuIHBvc2l0aW9uO1xufVxuXG5jb25zdCByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbSA9IChpdGVtcywgaXRlbUVxLCBhY3RpdmVDbGFzcykgPT4ge1xuICBpdGVtcy5lcShpdGVtRXEpLmFkZENsYXNzKGFjdGl2ZUNsYXNzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcbn1cblxuY29uc3QgcGVyZm9ybVRyYW5zaXRpb24gPSAoc2VjdGlvbkVxKSA9PiB7XG5cbiAgaWYoaW5zY3JvbGwpIHJldHVybjtcblxuICAgIGNvbnN0IHRyYW5zaXRpb25PdmVyID0gMTAwMDtcbiAgICBjb25zdCBtb3VzZUluZXJ0aWFPdmVyID0gMzAwO1xuXG4gICAgaW5zY3JvbGwgPSB0cnVlO1xuICAgIGNvbnN0IHBvc2l0aW9uID0gY291bnRTZWN0aW9uUG9zaXRpb24oc2VjdGlvbkVxKTtcblxuICBkaXNwbGF5LmNzcyh7XG4gICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYFxuICB9KTtcbiAgXG4gIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKHNlY3Rpb25zLCBzZWN0aW9uRXEsIFwiYWN0aXZlXCIpO1xuXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICBpbnNjcm9sbCA9IGZhbHNlO1xuXG4gICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCBcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKTtcblxuXG4gIH0sIHRyYW5zaXRpb25PdmVyICsgbW91c2VJbmVydGlhT3Zlcik7XG4gIH1cblxuY29uc3Qgdmlld3BvcnRTY3JvbGxlciA9ICgpID0+IHtcbiAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcihcIi5hY3RpdmVcIik7XG4gIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XG4gIGNvbnN0IHByZXZTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5wcmV2KCk7XG4gIFxuICByZXR1cm57XG4gICAgbmV4dCgpIHtcbiAgICAgIGlmKG5leHRTZWN0aW9uLmxlbmd0aCkge1xuICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihuZXh0U2VjdGlvbi5pbmRleCgpKVxuICAgICAgfVxuICAgIH0sXG4gICAgcHJldigpIHsgIFxuICAgIGlmKHByZXZTZWN0aW9uLmxlbmd0aCkge1xuICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpXG4gIH1cbiAgfSxcbiAgfTtcbn07XG5cbiQod2luZG93KS5vbihcIndoZWVsXCIsIGUgPT4ge1xuICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xuICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcbiAgXG4gIGlmIChkZWx0YVkgPiAwKSAge1xuICAgIHNjcm9sbGVyLm5leHQoKTtcbiAgfVxuXG4gIGlmIChkZWx0YVkgPCAwKSB7XG4gICAgc2Nyb2xsZXIucHJldigpO1xuICB9XG59KTtcblxuJCh3aW5kb3cpLm9uKFwia2V5ZG93blwiLCBlID0+IHtcbiAgY29uc3QgdGFnTmFtZSA9IGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgdXNlclR5cGluZ0luSW5wdXRzID0gdGFnTmFtZSA9PSBcImlucHV0XCIgfHwgdGFnTmFtZSA9PSBcInRleHRhcmVhXCI7XG4gIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xuXG4gIGlmICh1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgY2FzZSAzODogLy9wcmV2XG4gICAgICAgc2Nyb2xsZXIucHJldigpO1xuICAgICAgIGJyZWFrO1xuICBcbiAgICAgIGNhc2UgNDA6IC8vbmV4dFxuICAgICAgIHNjcm9sbGVyLm5leHQoKTtcbiAgICAgICBicmVhaztcbiAgICB9XG4gIFxufSk7XG5cbiQoXCIud3JhcHBlclwiKS5vbihcInRvdWNobW92ZVwiLGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcblxuJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIltkYXRhLXNjcm9sbC10b11cIiwgZSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtc2Nyb2xsLXRvXCIpO1xuICBjb25zdCByZXFTZWN0aW9uID0gJChgW2RhdGEtc2VjdGlvbi1pZD0ke3RhcmdldH1dYCk7XG5cbiAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcbn0pO1xuXG4vL3RvdWNoIHN3aXBlIFxuaWYgKGlzTW9iaWxlKSB7XG4gIC8vaHR0cHM6Ly9naXRodWIuY29tL21hdHRicnlzb24vVG91Y2hTd2lwZS1KcXVlcnktUGx1Z2luXG4kKFwiYm9keVwiKS5zd2lwZSgge1xuICBzd2lwZTpmdW5jdGlvbihcbiAgICBldmVudCwgXG4gICAgZGlyZWN0aW9uLFxuICAgICApIHtcbiAgICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcbiAgICBsZXQgc2Nyb2xsRGlyZWN0aW9uID0gXCJcIjtcblxuICAgIGlmIChkaXJlY3Rpb24gPT0gXCJ1cFwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcIm5leHRcIjtcbiAgICBpZiAoZGlyZWN0aW9uID09IFwiZG93blwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcInByZXZcIjtcbiAgICBpZiAoIXNjcm9sbERpcmVjdGlvbikgcmV0dXJuO1xuICAgIFxuICAgIHNjcm9sbGVyW3Njcm9sbERpcmVjdGlvbl0oKTtcbiAgfSxcbn0pO1xufVxuIiwiY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmlkZW9fX3BsYXllci1pbWdcIik7XG5jb25zdCB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXInKTtcbmNvbnN0IHBsYXllclBsYXlCcm4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmR1cmF0aW9uX19pbWdcIik7XG5jb25zdCBkdXJhdGlvbkNvbnRyb2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHVyYXRpb25MZXZlbCcpO1xuY29uc3Qgc291bmRDb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pY0xldmVsJyk7XG5jb25zdCBzb3VuZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VuZEJ0bicpO1xuY29uc3QgZHluYW1pY0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkeW5hbWljJyk7XG5cbmxldCBpbnRlcnZhbElkO1xubGV0IHNvdW5kTGV2ZWw7XG5cbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkZWRkYXRhXCIsIGZ1bmN0aW9uKCkge1xuICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlTdG9wKTtcblxuICBsZXQgcGxheUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGxheScpO1xuXG4gIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBwbGF5QnV0dG9ucy5sZW5ndGg7IGluZGV4KyspIHtcbiAgcGxheUJ1dHRvbnNbaW5kZXhdLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGxheVN0b3ApO1xufVxuXG5kdXJhdGlvbkNvbnRyb2wubWluID0gMDtcbmR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IDA7XG5kdXJhdGlvbkNvbnRyb2wubWF4ID0gdmlkZW8uZHVyYXRpb247XG5kdXJhdGlvbkNvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBzZXRWaWRlb0R1cmF0aW9uKTtcblxuc291bmRDb250cm9sLm1pbiA9IDA7XG5zb3VuZENvbnRyb2wubWF4ID0gMTA7XG5zb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZENvbnRyb2wubWF4O1xuc291bmRDb250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgY2hhbmdlU291bmRWb2x1bWUpO1xuXG5keW5hbWljQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc291bmRPZik7XG5cbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgKCkgPT4ge1xuICBwbGF5QnRuLmNsYXNzTGlzdC50b2dnbGUoJ3ZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmUnKTtcbiAgcGxheWVyUGxheUJybi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgdmlkZW8uY3VycmVudFRpbWUgPSAwO1xufSlcbn0pO1xuXG5mdW5jdGlvbiBwbGF5U3RvcChlKSB7XG4gIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIHBsYXllclBsYXlCcm4uY2xhc3NMaXN0LnRvZ2dsZSgndmlkZW9fX3BsYXllci1pbWctLWFjdGl2ZScpO1xuICBwbGF5QnRuLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICBpZiAodmlkZW8ucGF1c2VkKSB7XG4gICAgdmlkZW8ucGxheSgpO1xuICAgIGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVEdXJhdGlvbiwgMTAwMCAvIDYwKTtcbiAgfSBlbHNle1xuICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XG4gICAgdmlkZW8ucGF1c2UoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRWaWRlb0R1cmF0aW9uKCkge1xuICB2aWRlby5jdXJyZW50VGltZSA9IGR1cmF0aW9uQ29udHJvbC52YWx1ZTtcbiAgdXBkYXRlRHVyYXRpb24oKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlRHVyYXRpb24oKSB7XG4gIGR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IHZpZGVvLmN1cnJlbnRUaW1lO1xuICBsZXQgc3RlcCA9IHZpZGVvLmR1cmF0aW9uIC8gMTAwO1xuICBsZXQgcGVyY2VudCA9IHZpZGVvLmN1cnJlbnRUaW1lIC8gc3RlcDtcbiAgZHVyYXRpb25Db250cm9sLnN0eWxlLmJhY2tncm91bmQgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjRTAxRjNEIDAlLCAjRTAxRjNEICR7cGVyY2VudH0lLCAjMzMzICR7cGVyY2VudH0lKWA7XG59XG5cbmZ1bmN0aW9uIGNoYW5nZVNvdW5kVm9sdW1lKCkge1xuICB2aWRlby52b2x1bWUgPSBzb3VuZENvbnRyb2wudmFsdWUgLyAxMDtcbiAgaWYodmlkZW8udm9sdW1lID09IDApe1xuICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICB9IGVsc2Uge1xuICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNvdW5kT2YoKSB7XG4gIGlmICh2aWRlby52b2x1bWUgPT09IDApIHtcbiAgICB2aWRlby52b2x1bWUgPSBzb3VuZExldmVsO1xuICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kTGV2ZWwgKiAxMDtcbiAgICBzb3VuZEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgfSBlbHNlIHtcbiAgICBzb3VuZExldmVsID0gdmlkZW8udm9sdW1lO1xuICAgIHZpZGVvLnZvbHVtZSA9IDA7XG4gICAgc291bmRDb250cm9sLnZhbHVlID0gMDtcbiAgICBzb3VuZEJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgfVxufSIsImNvbnN0IHNsaWRlciA9ICQoJy5wcm9kdWN0c19fbGlzdCcpLmJ4U2xpZGVyKHtcbiAgcGFnZXI6IGZhbHNlLFxuICBjb250cm9sczogZmFsc2Vcbn0pO1xuXG4kKFwiLnByb2R1Y3Qtc2xpZGVyX19hcnJvdy0tcHJldlwiKS5jbGljayhlID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBzbGlkZXIuZ29Ub1ByZXZTbGlkZSgpO1xuXG59KTtcbiQoXCIucHJvZHVjdC1zbGlkZXJfX2Fycm93LS1uZXh0XCIpLmNsaWNrKGUgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIHNsaWRlci5nb1RvTmV4dFNsaWRlKCk7XG59KTsiLCJjb25zdCBmaW5kQmxvY2tCeUFsaWFzID0gYWxpYXMgPT4ge1xuICByZXR1cm4gJChcIi5yZXZpZXdzX19pdGVtXCIpLmZpbHRlcigobmR4LCBpdGVtKSA9PiB7XG4gICAgcmV0dXJuICQoaXRlbSkuYXR0cihcImRhdGEtbGlua2VkLXdpdGhcIikgPT0gYWxpYXM7XG4gIH0pO1xufTtcblxuJChcIi5yZXZpZXctc3dpdGNoZXJfX2xpbmtcIikuY2xpY2soZSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtb3BlblwiKTtcbiAgY29uc3QgaXRlbXRvU2hvdyA9IGZpbmRCbG9ja0J5QWxpYXModGFyZ2V0KTtcbiAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIuaW50ZXJhY3RpdmUtYXZhdGFyXCIpO1xuXG4gIGl0ZW10b1Nob3cuYWRkQ2xhc3MoXCJhY3RpdmVcIikuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgY3VySXRlbS5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xufSk7IiwiY29uc3Qgb3Blbkl0ZW0gPSBpdGVtID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLnRlYW1fX2l0ZW1cIik7XG4gIGNvbnN0IGNvbnRlbnRCbG9jayA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2NvbnRlbnRcIik7XG4gIGNvbnN0IHRleHRCbG9jayA9IGNvbnRlbnRCbG9jay5maW5kKFwiLnRlYW1fX2NvbnRlbnQtYmxvY2tcIik7XG4gIGNvbnN0IHJlcUhlaWdodCA9IHRleHRCbG9jay5oZWlnaHQoKTtcblxuXG4gIGNvbnRhaW5lci5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgY29udGVudEJsb2NrLmhlaWdodChyZXFIZWlnaHQpO1xufVxuXG5jb25zdCBjbG9zZUV2ZXJ5SXRlbSA9IGNvbnRhaW5lciA9PiB7XG4gIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9fY29udGVudFwiKTtcbiAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2l0ZW1cIik7XG5cbiAgaXRlbUNvbnRhaW5lci5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgaXRlbXMuaGVpZ2h0KDApO1xufVxuXG4kKFwiLnRlYW1fX3RpdGxlXCIpLmNsaWNrKGUgPT4ge1xuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi50ZWFtXCIpO1xuICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi50ZWFtX19pdGVtXCIpO1xuXG4gIGlmIChlbGVtQ29udGFpbmVyLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XG4gICAgY2xvc2VFdmVyeUl0ZW0oY29udGFpbmVyKTtcbiAgfSBlbHNlIHtcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xuICAgIG9wZW5JdGVtKCR0aGlzKTtcbiAgfVxuICBcblxufSk7Il19
